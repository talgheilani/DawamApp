@model IEnumerable<DawamApp.Models.EmployeeStatus>

@{
    ViewData["Title"] = "Admin Calendar - DawamApp";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<style>
    .sidebar {
        width: 200px;
        border-right: 1px solid #ddd;
        padding: 20px;
        border-radius: 5px;
        background-color: #3466bc29;
    }

    .fc-day-sat, .fc-day-fri {
        background-color: #f8f9fa;
    }

    .fc .fc-button {
        background-color: #224587;
        border-color: #224587;
        color: #fff;
        font-weight: 500;
    }

    .fc .fc-button:hover,
    .fc .fc-button:focus,
    .fc .fc-button:active {
        background-color: #1b356e;
        border-color: #1b356e;
        color: #fff;
    }

    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background-color: #1b356e;
        border-color: #1b356e;
        color: #fff;
    }

    .header-bar {
        background-color: #3466bc29;
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .access-message {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 5px;
        padding: 10px 15px;
        margin-bottom: 15px;
        text-align: center;
    }
</style>

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar Filters -->
        <div class="col-md-2 sidebar">
            <h5>Filters</h5>
            <div class="mb-2">
                <input type="checkbox" id="all" checked>
                <label for="all">All</label>
            </div>
            <div class="mb-2">
                <input type="checkbox" class="status-filter" value="Training" checked>
                <label>Training</label>
            </div>
            <div class="mb-2">
                <input type="checkbox" class="status-filter" value="Discharge" checked>
                <label>Discharge</label>
            </div>
            <div class="mb-2">
                <input type="checkbox" class="status-filter" value="Holiday" checked>
                <label>Holiday</label>
            </div>
            <div class="mb-2">
                <input type="checkbox" class="status-filter" value="Duty" checked>
                <label>Duty</label>
            </div>
            <div class="mb-2">
                <input type="checkbox" class="status-filter" value="Workshop" checked>
                <label>Workshop</label>
            </div>
        </div>

        <!-- Calendar -->
        <div class="col-md-10">

            <!-- Access Granted Message -->
            @if(ViewBag.AccessGranted != null && ViewBag.AccessGranted == true)
            {
                <div class="access-message">
                    Access Granted. Welcome Admin!
                </div>
            }

            <!-- Light blue rectangle with buttons and title -->
            <div class="header-bar">
                <h2 class="mb-0">Admin Calendar</h2>
                <a href="/User/Edit" class="btn btn-primary" style="background-color:#224587; border-color:#224587; border-radius:0;">
                    <i class="bi bi-pencil-square"></i> Edit Statuses
                </a>
            </div>

            <div id="calendar"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridWeek,dayGridMonth,multiMonthYear'
        },
        views: {
            multiMonthYear: {
                type: 'dayGridMonth',
                duration: { months: 12 },
                buttonText: 'Year'
            }
        },
        events: function(fetchInfo, successCallback, failureCallback) {
            var filters = [];
            document.querySelectorAll('.status-filter:checked').forEach(cb => filters.push(cb.value));
            fetch('/Admin/GetEvents?statuses=' + filters.join(','))
                .then(res => res.json())
                .then(data => successCallback(data))
                .catch(err => failureCallback(err));
        }
    });

    calendar.render();

    // Filters
    document.querySelectorAll('.status-filter').forEach(cb => {
        cb.addEventListener('change', function () {
            calendar.refetchEvents();
            document.getElementById('all').checked =
                document.querySelectorAll('.status-filter:checked').length ===
                document.querySelectorAll('.status-filter').length;
        });
    });

    document.getElementById('all').addEventListener('change', function() {
        var checked = this.checked;
        document.querySelectorAll('.status-filter').forEach(cb => cb.checked = checked);
        calendar.refetchEvents();
    });
});
</script>
